<link rel="stylesheet" href="modules/foundry-api-bridge/styles/config-form.css">

<form class="foundry-api-bridge-config-form">
  <!-- API Server Settings -->
  <div class="section">
    <h2>API Server Settings</h2>

    <div class="form-grid">
      <div class="form-group full-width">
        <label for="apiServerUrl">Server URL</label>
        <input type="text" name="apiServer.url" id="apiServerUrl" value="{{config.apiServer.url}}" placeholder="http://localhost:3001" />
      </div>

      <div class="form-group">
        <label for="updateInterval">Update Interval (ms)</label>
        <input type="number" name="apiServer.updateInterval" id="updateInterval" value="{{config.apiServer.updateInterval}}" min="1000" step="1000" />
      </div>

      <div class="form-group">
        <label for="worldDataEndpoint">World Data Endpoint</label>
        <input type="text" name="apiServer.endpoints.worldData" id="worldDataEndpoint" value="{{config.apiServer.endpoints.worldData}}" placeholder="/update" />
      </div>

      <div class="form-group full-width">
        <label for="compendiumEndpoint">Compendium Endpoint</label>
        <input type="text" name="apiServer.endpoints.compendium" id="compendiumEndpoint" value="{{config.apiServer.endpoints.compendium}}" placeholder="/update-compendium" />
      </div>
    </div>
  </div>

  <!-- Features -->
  <div class="section">
    <h2>Features</h2>

    <div class="checkbox-group">
      <label class="checkbox-label">
        <input type="checkbox" name="features.collectWorldData" {{#if config.features.collectWorldData}}checked{{/if}} />
        <span>Collect World Data</span>
      </label>

      <label class="checkbox-label">
        <input type="checkbox" name="features.periodicUpdates" {{#if config.features.periodicUpdates}}checked{{/if}} />
        <span>Enable Periodic Updates</span>
      </label>

      <label class="checkbox-label">
        <input type="checkbox" name="features.autoLoadCompendium" {{#if config.features.autoLoadCompendium}}checked{{/if}} />
        <span>Auto-load Compendium on Ready</span>
      </label>
    </div>
  </div>

  <!-- Compendia Selection -->
  <div class="section">
    <h2>
      <i class="fas fa-book"></i> Compendia Auto-Load
      <span class="compendium-counter" id="compendiumCounter">0 selected</span>
    </h2>

    <p class="section-description">
      <i class="fas fa-info-circle"></i>
      Select which compendium packs to automatically load and send to the API server when world is ready
    </p>

    {{#if availableCompendia}}
      <!-- Search and Bulk Actions -->
      <div class="compendium-controls">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input
            type="text"
            id="compendiumSearch"
            placeholder="Search compendia..."
            autocomplete="off"
          />
        </div>
        <div class="bulk-actions">
          <button type="button" class="bulk-btn" id="selectAllBtn">
            <i class="fas fa-check-double"></i> Select All
          </button>
          <button type="button" class="bulk-btn" id="deselectAllBtn">
            <i class="fas fa-times"></i> Deselect All
          </button>
        </div>
      </div>

      <!-- Compendia List -->
      <div class="compendium-list" id="compendiumList">
        {{#each availableCompendia}}
          <label class="compendium-item" data-name="{{this.label}}" data-id="{{this.id}}" data-type="{{this.type}}">
            <input
              type="checkbox"
              name="compendium.{{this.id}}"
              class="compendium-checkbox"
              {{#if this.isChecked}}checked{{/if}}
            />
            <span class="compendium-info">
              <span class="compendium-label">
                <i class="fas {{#if (eq this.type 'Actor')}}fa-user{{else}}{{#if (eq this.type 'Item')}}fa-suitcase{{else}}{{#if (eq this.type 'JournalEntry')}}fa-book-open{{else}}fa-folder{{/if}}{{/if}}{{/if}}"></i>
                {{this.label}}
              </span>
              <span class="compendium-meta">
                <span class="compendium-id">{{this.id}}</span>
                <span class="compendium-type-badge compendium-type-{{this.type}}">{{this.type}}</span>
                {{#if this.documentCount}}
                  <span class="compendium-count-badge">{{this.documentCount}} docs</span>
                {{/if}}
              </span>
            </span>
          </label>
        {{/each}}
      </div>
    {{else}}
      <div class="no-compendia">
        <i class="fas fa-inbox"></i>
        <p>No compendia available</p>
        <p class="help-text">Install compendium modules (like D&D 5e SRD) to see them here</p>
      </div>
    {{/if}}
  </div>

  <!-- Logging -->
  <div class="section">
    <h2>Logging</h2>

    <div class="form-grid">
      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" name="logging.enabled" {{#if config.logging.enabled}}checked{{/if}} />
          <span>Enable Logging</span>
        </label>
      </div>

      <div class="form-group">
        <label for="logLevel">Log Level</label>
        <select name="logging.level" id="logLevel">
          <option value="debug" {{#if (eq config.logging.level "debug")}}selected{{/if}}>Debug</option>
          <option value="info" {{#if (eq config.logging.level "info")}}selected{{/if}}>Info</option>
          <option value="warn" {{#if (eq config.logging.level "warn")}}selected{{/if}}>Warn</option>
          <option value="error" {{#if (eq config.logging.level "error")}}selected{{/if}}>Error</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Submit Button -->
  <button type="submit" name="submit">
    <i class="fas fa-save"></i> Save Configuration
  </button>
</form>
